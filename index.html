---
layout: default
title: Kubernetes Bundle
---

<h1>kubernetes-bundle</h1>

<p>The kubernetes-bundle allows you to deploy the many services of
Kubernetes to a cloud environment and get started using the Kubernetes
technology quickly.</p>

<h2>Kubernetes</h2>

<p>Kubernetes is an open source system for managing containerized
applications.  Kubernetes uses <a href="http://docker.com">Docker</a> to run
containerized applications.</p>

<h2>Juju TL;DR</h2>

<p>The <a href="https://juju.ubuntu.com">Juju</a> system provides provisioning and
orchestration across a variety of clouds and bare metal. A juju bundle
describes collection of services and how they interelate. <code>juju
quickstart</code> allows you to bootstrap a deployment environment and
deploy a bundle.</p>

<h2>Dive in!</h2>

<h4>Install Juju Quickstart</h4>

<p>You will need to
<a href="https://juju.ubuntu.com/install/">install the Juju client</a> and
<code>juju-quickstart</code> as pre-requisites.  To deploy the bundle use
<code>juju-quickstart</code> which runs on Mac OS (<code>brew install
juju-quickstart</code>) or Ubuntu (<code>apt-get install juju-quickstart</code>).</p>

<h3>Deploy Kubernetes Bundle</h3>

<p>Deploy Kubernetes onto any cloud and orchestrated directly in the Juju
Graphical User Interface using <code>juju quickstart</code>:</p>

<pre><code>juju quickstart -i https://raw.githubusercontent.com/whitmo/bundle-kubernetes/master/bundles.yaml
juju expose kubernetes-master
</code></pre>

<p>The command above does few things for you:</p>

<ul>
<li>Starts a curses based gui for managing your cloud or MAAS credentials</li>
<li>Looks for a bootstrapped deployment environment, and bootstraps if
required. This will launch a bootstrap node in your chosen
deployment environment (machine 0).</li>
<li>Deploys the Juju GUI to your environment onto the bootstrap node.</li>
<li>Provisions 4 machines, and deploys the Kubernetes services on top of
them (Kubernetes-master, two Kubernetes minions using flannel, and etcd).</li>
<li>Orchestrates the relations among the services, and exits.</li>
</ul>

<p>Now you should have a running Kubernetes. Run <code>juju status
--format=oneline</code> to see the address of your kubernetes master.</p>

<p>For further reading on <a href="https://pypi.python.org/pypi/juju-quickstart">Juju Quickstart</a></p>

<h3>Using the Kubernetes Client</h3>

<p>You'll need the Kubernetes command line client,
<a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/kubectl.md">kubectl</a>
to interact with the created cluster.  The kubectl command is
installed on the kubernetes-master charm. If you want to work with
the cluster from your computer you will need to install the binary
locally (see instructions below).</p>

<p>You can access kubectl by a number ways using juju.</p>

<p>via juju run:</p>

<pre><code>juju run --service kubernetes-master/0 "sudo kubectl get mi"
</code></pre>

<p>via juju ssh:</p>

<pre><code>juju ssh kubernetes-master/0 -t "sudo kubectl get mi"
</code></pre>

<p>You may also <code>juju ssh kubernetes-master/0</code> and call kubectl from that
machine.</p>

<p>See the
<a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/kubectl.md">kubectl documentation</a>
for more details of what can be done with the command line tool.</p>

<h3>Scaling up the cluster</h3>

<p>You can add capacity by adding more flannel units and Kubernetes minions:</p>

<pre><code> juju add-unit flannel
 juju add-unit kubernetes --to # (the id that flannel is assigned)
</code></pre>

<h3>Known Limitations</h3>

<p>Kubernetes currently has several platform specific functionality. For
example load balancers and persistence volumes only work with the
Google Compute provider at this time.</p>

<p>The Juju integration uses the Kubernetes null provider. This means
external load balancers and storage can't be directly driven through
Kubernetes config files at this time. We look forward to adding these
capabilities to the charms.</p>

<h2>More about the components the bundle deploys</h2>

<h3>Kubernetes master</h3>

<p>The master controls the Kubernetes cluster.  It manages for the worker
nodes and provides the primary interface for control by the user.</p>

<h3>Kubernetes minion</h3>

<p>The minions are the servers that perform the work.  Minions must
communicate with the master and run the workloads that are assigned to
them.</p>

<h3>Flannel</h3>

<p>Flannel provides individual subnets for each machine in the cluster by
creating a
<a href="http://en.wikipedia.org/wiki/Software-defined_networking">software defined networking</a>.</p>

<h3>Etcd</h3>

<p>Etcd persists state for Flannel and Kubernetes. It is a distributed
key-value store with an http interface.</p>

<h2>For further information on getting started with Juju</h2>

<p>Juju has complete documentation with regard to setup, and cloud
configuration on it's own
<a href="https://juju.ubuntu.com/docs/">documentation site</a>.</p>

<ul>
<li><a href="https://juju.ubuntu.com/docs/getting-started.html">Getting Started</a></li>
<li><a href="https://juju.ubuntu.com/docs/charms.html">Using Juju</a></li>
</ul>

<h2>Installing the kubectl outside of kubernetes master machine</h2>

<p>Download the Kuberentes release from:
https://github.com/GoogleCloudPlatform/kubernetes/releases and extract
the release, you can then just directly use the cli binary at
./kubernetes/platforms/linux/amd64/kubectl</p>

<p>You'll need the address of the kubernetes-master as environment variable :</p>

<pre><code>juju status kubernetes-master/0
</code></pre>

<p>Grab the public-address there and export it as KUBERNETES_MASTER
environment variable :</p>

<pre><code>export KUBERNETES_MASTER=$(juju status --format=oneline kubernetes-master | cut -d' ' -f3):8080
</code></pre>

<p>And now you can run kubectl on the command line :</p>

<pre><code>kubectl get mi
</code></pre>

<p>See the
<a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/kubectl.md">kubectl documentation</a>
for more details of what can be done with the command line tool.</p>

<h2>Hacking on the kubernetes-bundle and associated charms</h2>

<p>The kubernetes-bundle is open source and available on github.com.  If
you want to get started developing on the bundle you can clone it from
github.  Often you will need the related charms which are also on
github.</p>

<pre><code>mkdir ~/bundles
git clone https://github.com/whitmo/kubernetes-bundle.git ~/bundles/kubernetes-bundle
mkdir -p ~/charms/trusty
git clone https://github.com/whitmo/kubernetes-charm.git ~/charms/trusty/kubernetes
git clone https://github.com/whitmo/kubernetes-master-charm.git ~/charms/trusty/kubernetes-master
git clone https://github.com/whitmo/etcd-charm.git ~/charms/trusty/etcd-charm
git clone https://github.com/whitmo/flannel-charm.git ~/charms/trusty/flannel-charm

juju quickstart specs/develop.yaml
juju expose kubernetes-master
</code></pre>

<h2>How to contribute</h2>

<p>Send us pull requests!  We'll send you a cookie if they include tests and docs.</p>

<h2>Current and Most Complete Information</h2>

<ul>
<li><a href="https://github.com/whitmo/charm-kubernetes-master">kubernetes-master charm on Github</a></li>
<li><a href="https://github.com/whitmo/charm-kubernetes">kubernetes charm on GitHub</a></li>
<li><a href="https://github.com/whitmo/etcd-charm">etcd charm on GitHub</a></li>
<li><a href="https://github.com/whitmo/flannel-charm">Flannel charm on GitHub</a></li>
</ul>

<p>More information about the
<a href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes project</a>
or check out the
<a href="https://github.com/GoogleCloudPlatform/kubernetes/tree/master/docs">Kubernetes Documentation</a>
for more details about the Kubernetes concepts and terminology.</p>

<p>Having a problem? Check the <a href="https://github.com/GoogleCloudPlatform/kubernetes/issues">Kubernetes issues database</a>
for related issues.</p>
